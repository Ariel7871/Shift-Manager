{% extends 'base.html' %}
{% block content %}
<div class="card shadow">
  <div class="card-header bg-dark text-white">
    <h4 class="mb-0">
      <i class="fa-solid fa-calendar-days me-2"></i>Monthly Schedule
    </h4>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <!-- Header with different styling for Date and Day -->
            <th class="text-center text-primary fw-bold">Date</th>
            <th class="text-center text-primary fw-bold">Day</th>
            {% for user in users %}
              <th class="text-center text-secondary fw-bold">{{ user['name'] }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for month_label, entries in grouped_schedule_data.items() %}
            <!-- Month header row -->
            <tr class="table-secondary">
              <td colspan="{{ 2 + users|length }}" class="text-center fw-bold">
                {{ month_label }}
              </td>
            </tr>
            {% for entry in entries %}
              {% set is_today = (entry.date == today) %}
              <tr class="{% if is_today %}table-primary{% endif %}">
                <td class="text-center">
                  {% if is_today %}
                    <i class="fa-solid fa-calendar-check me-1"></i>
                  {% endif %}
                  {{ entry.date.strftime("%d/%m/%Y") }}
                </td>
                <td class="text-center">
                  {{ entry.day_name }}
                  {% if entry.is_holiday %}
                    <br>
                    <i class="fa-solid fa-gift text-danger"></i>
                    Public Holiday: {{ entry.holiday_name }}
                  {% endif %}
                </td>
                {% for user in users %}
                  <td class="text-center">
                    {% set shift = user_schedules[user['name']].get(entry.week_start, {}).get(entry.day_name) %}
                    {% if entry.day_name == 'Sunday' %}
                      <i class="fa-solid fa-sun text-warning" title="Day Shift"></i>
                    {% elif shift == 'Day' %}
                      <i class="fa-solid fa-sun text-warning" title="Day Shift"></i>
                    {% elif shift == 'Night' %}
                      <i class="fa-solid fa-moon text-muted" title="Night Shift"></i>
                    {% else %}
                      Not Set
                    {% endif %}
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="mt-4 text-center">
    <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">
      <i class="fa-solid fa-arrow-left me-1"></i>Back to Home
    </a>
  </div>
</div>
{% endblock %}
